(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["BillReservedSubAdd"],{"047a":function(e,t,r){"use strict";var n=r("05b0"),a=r.n(n);a.a},"05b0":function(e,t,r){},b475:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("audit-wrapper",{attrs:{"extra-info":e.extraInfo}},[r("el-form",{ref:"form",attrs:{model:e.form,inline:"",rules:e.rules}},[r("el-row",[r("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[r("el-form-item",{attrs:{label:"需求日期",prop:"needDate"}},[r("el-date-picker",{staticStyle:{width:"178px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"请选择交货日期",disabled:["audit","detail"].includes(e.pageType)},model:{value:e.form.needDate,callback:function(t){e.$set(e.form,"needDate",t)},expression:"form.needDate"}})],1)],1),r("el-col",{staticStyle:{"margin-bottom":"15px"},attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[r("table-com",{ref:"baseTableRef",attrs:{loading:!1,index:!0,selection:!1,"table-data":e.form.detailList,"column-list":e.columnList,"operation-width":190,"expand-list":e.expandList,"table-column-sort":!1,"table-height-type":680,"show-operate":!["audit","detail","edit"].includes(e.pageType)},on:{rowClick:e.handleRowClick,refresh:e.searchInit},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"danger"},on:{click:function(r){return e.handleDelete(t.$index)}}},[e._v("删除")])]}}])})],1),"audit"===e.pageType?r("el-col",{staticStyle:{"margin-bottom":"15px"},attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[r("el-form-item",{staticClass:"approval-opinion",attrs:{prop:"message",label:"审批意见："}},[r("el-input",{attrs:{type:"textarea",placeholder:"请填写审批意见",rows:5},model:{value:e.form.message,callback:function(t){e.$set(e.form,"message",t)},expression:"form.message"}})],1)],1):e._e()],1),r("div",{staticClass:"btn-context"},["audit"===e.pageType?[r("el-button",{attrs:{type:"primary",loading:e.buttonLoading},on:{click:function(t){return e.onAudit(1)}}},[e._v("通 过")]),r("el-button",{attrs:{type:"danger",loading:e.buttonLoading},on:{click:function(t){return e.onAudit(0)}}},[e._v("驳 回")]),r("el-button",{attrs:{type:"primary",loading:e.buttonLoading},on:{click:function(t){return e.onAudit(2)}}},[e._v("不 通 过")])]:e._e(),"add"===e.pageType?[r("el-button",{attrs:{type:"primary",loading:e.buttonLoading},on:{click:function(t){return e.onSave("form")}}},[e._v("保 存")])]:e._e(),"edit"===e.pageType?[r("el-button",{attrs:{type:"primary",loading:e.buttonLoading},on:{click:function(t){return e.onSave("form")}}},[e._v("保 存")])]:e._e(),r("el-button",{attrs:{loading:e.buttonLoading},on:{click:e.goBack}},[e._v("取消")])],2)],1)],1)},a=[],o=(r("8e6e"),r("ac6a"),r("456d"),r("96cf"),r("3b8d")),i=r("bd86"),s=(r("7f7f"),r("a481"),r("6762"),r("2fdb"),r("ef4d")),l=r("2ef0"),u=r.n(l),c=r("1790"),d=r("cc37"),m=r("fa7d");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b=function(){return{needDate:"",message:"",detailList:[]}},g={components:{AuditWrapper:s["a"]},mixins:[c["a"]],props:{},data:function(){var e=this;return{query:{},tableData:[],columnList:[{module:"word",prop:"materialGroupCode",label:"物料组",align:"center",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"materialGroupDesc",label:"物料组描述",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"materialCode",label:"物料编码",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"materialName",label:"物料名称",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"assessType_dictText",label:"评估类型",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,headerAlign:"center"},{module:"word",prop:"unitName",label:"单位",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"needDate",label:"需求日期",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"number",prop:"needNum",label:"需求数量",align:"center",minWidth:160,fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center",setMin:function(e){return 0},disabled:function(t){return["audit","detail"].includes(e.pageType)},setMax:function(e){return e.allowMaxNum},handleChange:u.a.throttle((function(e){}),1e3),setPrecision:function(e){return 3}}],expandList:[],form:b(),rules:{needDate:[{required:!0,message:"请选择需求日期",trigger:"change"}],message:[{required:!0,message:"请填写审批意见",trigger:"blur"}]},buttonLoading:!1,extraInfo:null}},computed:{pageType:function(){return"auditHistory"===this.$route.query.type?"detail":this.$route.name.replace("BillReservedSub","").toLowerCase()||"add"}},mounted:function(){"add"!==this.pageType&&this.getDetail()},methods:{handleRowClick:function(e){e.row;var t=e.column;e.cell,e.event;if("操作"===t.label)return!1},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该物料, 是否继续?","提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",cancelButtonClass:"btn-custom-cancel",type:"warning",lockScroll:!1}).then((function(){t.form.detailList.splice(e,1),t.$message({type:"success",message:"操作成功"})})).catch((function(){t.$message({message:"已取消删除",type:"info"})}))},getDetail:function(){var e=this;return new Promise((function(t,r){Object(d["e"])({subNumber:e.$route.query.billNumber}).then((function(r){var n=r.code,a=r.data;n||(e.form=a||{},e.extraInfo=r.data,t(r))})).catch((function(e){r(e)}))}))},onSave:function(e){var t=this,r={add:d["a"],edit:d["d"]},n=r[this.pageType];this.$refs[e].validate((function(e){if(!e)return!1;if(t.form.detailList.length){var r=t.form.detailList.some((function(e){return!e.needNum}));r?t.$message({message:"需求数量存在为0的情况，请重新编辑！",type:"warning"}):(t.buttonLoading=!0,n(p({},t.form)).then((function(e){var r=e.code;r||(t.$message({message:"操作成功",type:"success"}),t.goBack()),t.buttonLoading=!1})).catch((function(e){t.buttonLoading=!1})))}else t.$message({message:"至少新增一条物料",type:"warning"})}))},goBack:function(){var e=Object.assign({},this.$route);this.$store.dispatch("tagsView/delView",e),this.$refs.form.resetFields(),this.form=b(),this.$router.go(-1)},onAudit:function(e){var t=this,r={1:"该工单即将审批通过，是否继续？",0:"该工单即将驳回, 是否继续?",2:"该工单即将不通过, 是否继续?"}[e];this.$refs.form.validate(function(){var n=Object(o["a"])(regeneratorRuntime.mark((function n(a){var o,i,s,l,u,c,f;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,Object(m["b"])(t.$confirm(r,"提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",type:"warning",cancelButtonClass:"btn-custom-cancel",lockScroll:!1}));case 4:if(o=n.sent,o.success){n.next=7;break}return n.abrupt("return");case 7:return t.buttonLoading=!0,i=t.$route.params.id,s=t.$route.query,l=s.billNumber,u=s.taskId,c=s.processInstanceId,n.next=12,Object(m["c"])(Object(d["b"])({businessId:i,billNumber:l,taskId:u,processInstanceId:c,approval:e,message:t.form.message}));case 12:if(f=n.sent,t.buttonLoading=!1,f.success){n.next=16;break}return n.abrupt("return");case 16:t.$message({message:"操作成功",type:"success"}),t.goBack();case 18:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}},h=g,v=(r("047a"),r("2877")),y=Object(v["a"])(h,n,a,!1,null,"0c622462",null);t["default"]=y.exports},cc37:function(e,t,r){"use strict";r.d(t,"g",(function(){return a})),r.d(t,"f",(function(){return o})),r.d(t,"a",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return l})),r.d(t,"e",(function(){return u})),r.d(t,"h",(function(){return c})),r.d(t,"i",(function(){return d})),r.d(t,"j",(function(){return m})),r.d(t,"b",(function(){return f}));var n=r("bc43");function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/listItem",method:"post",data:e})}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/pageList",method:"post",data:e})}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/add",method:"post",data:e})}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/edit",method:"post",data:e})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/delete",method:"post",data:e})}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/detail",method:"post",data:e})}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/print",method:"post",data:e})}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/submit",method:"post",data:e})}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/withdraw",method:"post",data:e})}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/audit",method:"post",data:e})}}}]);
//# sourceMappingURL=BillReservedSubAdd.f5b015d3.js.map