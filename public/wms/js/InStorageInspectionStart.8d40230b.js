(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["InStorageInspectionStart"],{"0946":function(e,t,n){},2391:function(e,t,n){"use strict";n.d(t,"l",(function(){return r})),n.d(t,"w",(function(){return a})),n.d(t,"h",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"u",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"t",(function(){return u})),n.d(t,"j",(function(){return d})),n.d(t,"p",(function(){return f})),n.d(t,"x",(function(){return h})),n.d(t,"d",(function(){return b})),n.d(t,"r",(function(){return m})),n.d(t,"k",(function(){return p})),n.d(t,"v",(function(){return v})),n.d(t,"o",(function(){return y})),n.d(t,"a",(function(){return g})),n.d(t,"q",(function(){return C})),n.d(t,"i",(function(){return w})),n.d(t,"n",(function(){return x})),n.d(t,"m",(function(){return O})),n.d(t,"s",(function(){return k})),n.d(t,"c",(function(){return I})),n.d(t,"e",(function(){return j})),n.d(t,"b",(function(){return D}));var i=n("bc43");function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/deliveryReceiptPageList",method:"post",data:e})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsDeliveryReceipt/finish",method:"post",data:e})}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/deliveryMaterialPageList",method:"post",data:e})}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/deliveryMaterialItemList",method:"post",data:e})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsDeliveryMaterial/finish",method:"post",data:e})}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/inspectPageList",method:"post",data:e})}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/save",method:"post",data:e})}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/detail",method:"post",data:e})}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/modifyInspectNo",method:"post",data:e})}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/editFile",method:"post",data:e})}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/fileList",method:"post",data:e})}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/saveInspectResult",method:"post",data:e})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/selectInspectResultByDeliveryMaterialId",method:"post",data:e})}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/submitInspectResult",method:"post",data:e})}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/inspectReject",method:"post",data:e})}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/barcodePrint",method:"post",data:e})}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/packageCodeSamplingList",method:"post",data:e})}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/genUnqualifiedBarcodeList",method:"post",data:e})}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/unqualifiedBarcodeScan",method:"post",data:e})}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/queryUnqualifiedBarcodeList",method:"post",data:e})}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/saveUnqualifiedBarcodeList",method:"post",data:e})}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/deleteUnqualifiedBarcode",method:"post",data:e})}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/editUnqualifiedBarcodeReason",method:"post",data:e})}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i["a"])({url:"/enterWarehouse/wmsInspect/deleteFile",method:"post",data:e})}},"32a6":function(e,t,n){var i=n("241e"),r=n("c3a1");n("ce7e")("keys",(function(){return function(e){return r(i(e))}}))},"35cf":function(e,t,n){"use strict";var i=n("e5e8"),r=n.n(i);r.a},"4c2c":function(e,t,n){"use strict";var i=n("cea1"),r=n.n(i);r.a},"5164c":function(e,t,n){"use strict";n("ac6a");t["a"]={data:function(){return{device:null,BrowserPrint:window.BrowserPrint,zebraPrinter:null,printType:"barCode",isPrinting:!1}},mounted:function(){this.getDevice()},beforeDestroy:function(){this.zebraPrinter=window.BrowserPrint,this.device=null},methods:{getDevice:function(){var e=this;this.BrowserPrint.getDefaultDevice("printer",(function(t){t&&(e.device=t)}),(function(e){}))},getDataAndPrint:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Promise,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return Promise.reject(new Error("error"));this.isPrinting=!0;var i=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});return new Promise((function(r,a){t(n).then((function(t){var n=t.code,a=t.data;n||a.forEach((function(t){e.print(t)})),i.close(),r(t)})).catch((function(e){i.close(),a(e)}))}))},print:function(e){this.isPrinting=!0;var t=this;this.device&&this.device.send(e,(function(e){t.isPrinting=!1}),(function(e){t.isPrinting=!1}))}}}},"79ee":function(e,t,n){"use strict";var i=n("b26b"),r=n.n(i);r.a},"87cd":function(e,t,n){"use strict";n("f559");t["a"]={data:function(){return{lastTime:void 0,nextTime:void 0,lastCode:void 0,nextCode:void 0,code:""}},mounted:function(){document.addEventListener("keypress",this.scan,!1)},methods:{scan:function(e){if(!this.scanDisabled){if(window.event?this.nextCode=e.keyCode:e.which&&(this.nextCode=e.which),13===e.which){if(this.code.length<3)return;if(!this.code.startsWith("{")){var t=this.code.indexOf("{");this.code=this.code.substring(t)}this.scanEnd(this.code),this.code="",this.lastCode="",this.lastTime=""}this.nextTime=(new Date).getTime(),this.lastTime||this.lastCode||(this.code+=e.key),this.lastCode&&this.lastTime&&this.nextTime-this.lastTime>30?this.code=e.key:this.lastCode&&this.lastTime&&(this.code+=e.key),this.lastCode=this.nextCode,this.lastTime=this.nextTime}}},beforeDestroy:function(){document.removeEventListener("keypress",this.scan,!1)}}},"8aae":function(e,t,n){n("32a6"),e.exports=n("584a").Object.keys},a2cc:function(e,t,n){"use strict";var i=n("0946"),r=n.n(i);r.a},a4bb:function(e,t,n){e.exports=n("8aae")},a8db:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n("e265"),r=n.n(i),a=n("a4bb"),o=n.n(a);function s(e,t){if(null==e)return{};var n,i,r={},a=o()(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function l(e,t){if(null==e)return{};var n,i,a=s(e,t);if(r.a){var o=r()(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}},aac8:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"clearfix top-filter"},[n("el-form",{ref:"filterItem",attrs:{model:e.query,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-form-item",{attrs:{prop:"nameOrCode"}},[n("el-input",{staticClass:"filter-item",staticStyle:{width:"178px"},attrs:{filterable:"",clearable:"",placeholder:"物料编号或名称"},on:{change:e.handleSearch},model:{value:e.query.nameOrCode,callback:function(t){e.$set(e.query,"nameOrCode",t)},expression:"query.nameOrCode"}})],1),n("el-button",{staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),n("el-button",{staticClass:"filter-item fr",on:{click:e.handleGoBack}},[e._v("返回")])],1)],1),n("el-row"),n("el-row",[n("el-descriptions",{attrs:{column:3,"label-style":{fontWeight:900},"content-style":{paddingRight:"10px",alignItems:"center"}}},[n("el-descriptions-item",{attrs:{label:"交接单号"}},[e._v(e._s(e.baseInfo.no||"---"))]),n("el-descriptions-item",{attrs:{label:"检验单号"}},[e._v(e._s(e.baseInfo.inspectNo||"---"))]),n("el-descriptions-item",{attrs:{label:"物料项数"}},[e._v(e._s(e.baseInfo.materialCount||"---"))]),n("el-descriptions-item",{attrs:{label:"物料总数"}},[e._v(e._s(e.baseInfo.materialTotal||"---"))]),n("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.baseInfo.createDate||"---"))]),n("el-descriptions-item",{attrs:{label:"接收人"}},[e._v(e._s(e.baseInfo.recipientName||"---"))])],1)],1),e.tabsList.length?n("tabs",{ref:"Tabs",attrs:{data:e.tabsList,height:"650px"},on:{tabPanelClick:e.handleTabClick},scopedSlots:e._u([{key:"main-container",fn:function(t){var i=t.handleClick;return[n("right",{key:e.rightKey,ref:"rightView",attrs:{node:e.nodeInfo},on:{enterNextMaterial:function(t){return e.enterNextMaterial(i)}}})]}}],null,!1,3522627696)}):e._e()],1)},r=[],a=(n("8e6e"),n("456d"),n("bd86")),o=(n("ac6a"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{class:{"sticky-header":e.isStickyBtn,"absolute-header":!e.isStickyBtn}},[n("el-button",{staticClass:"save-btn",attrs:{type:"primary",disabled:[3,4].includes(e.baseInfo.status)},on:{click:e.handleSave}},[e._v("保存")])],1),n("el-card",{staticClass:"box-card-rt",staticStyle:{border:"none"},attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("div",{staticClass:"clearfix",staticStyle:{display:"flex","align-items":"center"}},[n("div",[n("span",{staticStyle:{display:"block",padding:"0 15px"}},[e._v("物料信息")])])])]),n("el-descriptions",{attrs:{column:3,"label-style":{fontWeight:900},"content-style":{paddingRight:"10px",alignItems:"center"}}},[n("el-descriptions-item",{attrs:{label:"物料编号"}},[e._v(e._s(e.baseInfo.materialCode||e.node.materialCode||"---"))]),n("el-descriptions-item",{attrs:{label:"物料名称"}},[e._v(e._s(e.baseInfo.materialName||e.node.materialName||"---"))]),n("el-descriptions-item",{attrs:{label:"到货数量"}},[e._v(e._s(e.baseInfo.deliveryNumber||e.node.deliveryNumber||"---"))])],1),n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,inline:"",disabled:[3,4].includes(e.baseInfo.status)}},[n("el-form-item",{staticStyle:{margin:"0"},attrs:{prop:"inspectType",label:"检验类型"}},[n("el-radio-group",{staticClass:"filter-item",staticStyle:{width:"178px"},model:{value:e.form.inspectType,callback:function(t){e.$set(e.form,"inspectType",t)},expression:"form.inspectType"}},e._l([{name:"全检",value:1},{name:"抽检",value:2}],(function(t,i){return n("el-radio-button",{key:i,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1)],1)],1),e.baseInfo.useMinUnit?e._e():n("el-card",{staticClass:"box-card-rb",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("div",{staticClass:"clearfix",staticStyle:{display:"flex","align-items":"center"}},[n("div",[n("span",{staticStyle:{display:"block",padding:"0 15px"}},[e._v("包装条码列表")])])])]),n("table-com",{key:e.refreshKey,ref:"dmdTableRef",attrs:{loading:e.dmdLoading,index:!0,selection:!1,"table-data":e.packageCodeList,"column-list":e.dmdColumnList,"table-height-type":340,"operation-width":240,"table-column-sort":!1,"show-operate":!0},on:{rowClick:e.handleRowClick1},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"warning",disabled:[3,4].includes(e.baseInfo.status)},on:{click:function(n){return e.handleCaptchaHumanBypass(t.row)}}},[e._v("不合格品打码")]),n("el-button",{attrs:{type:"primary"},on:{click:function(n){return e.handlePrintBarcode(t.row)}}},[e._v("打印条码")])]}}],null,!1,3293627237)})],1),n("el-card",{staticClass:"box-card-rb",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("div",{staticClass:"clearfix",staticStyle:{display:"flex","align-items":"center"}},[n("div",[n("span",{staticStyle:{display:"block",padding:"0 15px"}},[e._v("不合格条码列表")])]),n("div",{staticStyle:{flex:"1"}},[n("div",{staticClass:"clearfix top-filter"},[e.baseInfo.useMinUnit?n("el-button",{staticClass:"fr",staticStyle:{"margin-right":"20px"},attrs:{type:"danger",disabled:[3,4].includes(e.baseInfo.status)},on:{click:e.handleScanQRCodes}},[e._v("不合格品扫码")]):e._e()],1)])])]),n("el-row",[n("table-com",{key:e.refreshKey,ref:"baseTableRef",attrs:{index:!0,selection:!1,"table-height-type":420,"table-data":e.tableData,"column-list":e.columnList,"operation-width":240,"show-operate":!0,"table-column-sort":!1},on:{rowClick:e.handleRowClick2},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary"},on:{click:function(n){return e.handlePrintBarcode(t.row)}}},[e._v("打印条码")]),n("el-button",{attrs:{type:"danger",disabled:[3,4].includes(e.baseInfo.status)},on:{click:function(n){return e.handleDeleteBarcode(t.row,t.$index)}}},[e._v("删除")])]}}])})],1)],1),n("captcha-human-bypass",{attrs:{"bar-code-list":e.tableData,"bar-code-number":e.currentItem.num,"extra-info":{deliveryMaterialId:e.node.id,deliveryMaterialDetailId:e.currentItem.deliveryMaterialDetailId,isShowHistoryUnqualified:e.isShowHistoryUnqualified}},on:{confirm:e.handleCaptchaHumanBypassConfirm},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}}),n("scan-qr-codes",{attrs:{"bar-code-list":e.tableData,"extra-info":{deliveryMaterialId:e.node.id}},on:{confirm:e.handleScanConfirm},model:{value:e.visible1,callback:function(t){e.visible1=t},expression:"visible1"}})],1)}),s=[],l=n("75fc"),c=n("a8db"),u=(n("2ef0"),n("1790")),d=n("5164c"),f=n("2391"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.title,top:"15vh",visible:e.value,"show-close":!0,width:"750px","lock-scroll":!1,"destroy-on-close":!0,"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.beforeClose},on:{open:e.initSelect}},[n("div",{staticClass:"clearfix top-filter"},[n("el-form",{ref:"form",attrs:{model:e.query,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-form-item",{attrs:{prop:"barCode",label:"条码号："}},[n("el-input",{staticClass:"filter-item",staticStyle:{width:"178px"},attrs:{clearable:"",placeholder:"请输入条码号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.query.barCode,callback:function(t){e.$set(e.query,"barCode",t)},expression:"query.barCode"}})],1),n("el-button",{staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-search"},on:{click:e.search}},[e._v("搜索")]),n("el-button",{staticClass:"filter-item",attrs:{type:"warning",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("form")}}},[e._v("重置")])],1)],1),n("el-scrollbar",{staticClass:"scroll-dialog"},[n("table-com",{ref:"baseTableRef",attrs:{loading:e.loading,index:!0,selection:!1,"table-height-type":430,"table-column-sort":!1,"column-list":e.columnList,"table-data":e.tableData,"operation-width":100,"show-operate":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger"},on:{click:function(n){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")]),n("el-button",{on:{click:e.beforeClose}},[e._v("取 消")])],1)],1)},b=[],m=(n("6762"),n("2fdb"),n("28a5"),n("c5f6"),n("87cd"));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=function(){return{barCode:""}},g={components:{},mixins:[u["a"],m["a"]],props:{value:{type:Boolean,default:!1},extraInfo:{type:Object,default:function(){return{}}},title:{type:[String,Number],default:"不合格品扫码"},barCodeList:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,query:y(),columnList:[{module:"word",prop:"barCode",label:"条码号",align:"center",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"snNo",label:"序列号",align:"center",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"number",label:"数量",align:"center",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"select",prop:"inspectResult",label:"检验结论",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center",placeholder:"请选择",optionLabel:"name",optionValue:"id",setDisabled:function(e){return!0},getOptions:function(e){return[{name:"不合格",id:!1},{name:"合格",id:!0}]}}],tableData:[],scanDisabled:!1}},methods:{initSelect:function(){this.resetForm("form"),this.tableData=[]},handlePublicFn:function(e){var t=this,n=e.barCode.split(":"),i=n.length>1?n[1]:n[0],r=this.barCodeList.map((function(e){return e.barCode})),a=r.includes(i);if(a)this.$notify.warning({title:"警告",message:"条码号".concat(i,"已存在，请重新扫码！")});else{this.query.barCode=i;var o=this.tableData.some((function(e){return-1!==e.barCode.indexOf(i)}));if(!o){var s=v({},this.extraInfo,{},this.query);return new Promise((function(e,n){Object(f["n"])(v({},s)).then((function(n){var i=n.code,r=n.data;i||r&&Array.isArray(r)&&r.length&&(t.tableData=[].concat(Object(l["a"])(r),Object(l["a"])(t.tableData))),e(n)})).catch((function(e){n(e)}))}))}}},scanEnd:function(e){var t=JSON.parse(e);this.handlePublicFn(t)},search:function(){this.query.barCode&&this.handlePublicFn(this.query)},beforeClose:function(e){"function"===typeof e&&e(),this.$emit("input",!1)},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该条码, 是否继续?","提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",cancelButtonClass:"btn-custom-cancel",type:"warning",lockScroll:!1}).then((function(){t.tableData=t.tableData.filter((function(t){return t.barCode!==e.barCode})),t.$notify.success({title:"成功",message:"该不合格品已删除"})})).catch((function(){t.$notify.info({title:"消息",message:"已取消删除"})}))},handleConfirm:function(){var e=this.barCodeList.map((function(e){return e.barCode})),t=this.tableData.filter((function(t){return!e.includes(t.barCode)}));this.$emit("confirm",t),this.$emit("input",!1)},resetForm:function(e){this.$refs[e].resetFields(),this.query=y()}}},C=g,w=(n("79ee"),n("2877")),x=Object(w["a"])(C,h,b,!1,null,"558ace43",null),O=x.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.title,top:"15vh",visible:e.value,"show-close":!0,width:"750px","lock-scroll":!1,"destroy-on-close":!0,"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.beforeClose},on:{open:e.initSelect}},[n("div",{staticClass:"clearfix top-filter"},[n("el-form",{ref:"filterItem",attrs:{model:e.query,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-form-item",{attrs:{prop:"splitNum",label:"条码数量："}},[n("el-input-number",{staticClass:"filter-item",staticStyle:{width:"178px"},attrs:{max:e.barCodeNumber,min:1,placeholder:"请输入条码数量"},model:{value:e.query.splitNum,callback:function(t){e.$set(e.query,"splitNum",t)},expression:"query.splitNum"}})],1),n("el-button",{staticClass:"filter-item primary-btn",attrs:{type:"primary"},on:{click:e.handleGenerateBarcode}},[e._v("打码")])],1)],1),n("el-scrollbar",{staticClass:"scroll-dialog"},[n("table-com",{ref:"baseTableRef",attrs:{loading:e.loading,index:!0,selection:!1,"table-height-type":430,"table-column-sort":!1,"column-list":e.columnList,"table-data":e.tableData,"operation-width":100,"show-operate":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",disabled:!t.row.isCanEdit},on:{click:function(n){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")]),n("el-button",{on:{click:e.beforeClose}},[e._v("取 消")])],1)],1)},I=[];function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S={components:{},mixins:[u["a"]],props:{value:{type:Boolean,default:!1},extraInfo:{type:Object,default:function(){return{}}},title:{type:[String,Number],default:"不合格品打码"},barCodeNumber:{type:[String,Number],default:""}},data:function(){var e=this;return{loading:!1,query:{splitNum:1},columnList:[{module:"word",prop:"barCode",label:"条码号",align:"center",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"number",prop:"number",label:"数量",align:"center",width:160,fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center",setMin:function(e){return 1},disabled:function(e){return!e.isCanEdit},setMax:function(t){var n=e.tableData.reduce((function(e,t){return e+t.number}),0);if(n===e.barCodeNumber)return t.number},handleChange:function(e){},showOverflowTooltip:!1},{module:"word",prop:"unitName",label:"计量单位",align:"center",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"input",prop:"remarks",label:"不合格原因",align:"center",width:160,fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"}],tableData:[],scanDisabled:!1}},methods:{initSelect:function(){this.query.splitNum=1,this.getUnqualifiedBarcodeList()},getUnqualifiedBarcodeList:function(){var e=this,t={deliveryMaterialDetailId:this.extraInfo.deliveryMaterialDetailId,isShowHistoryUnqualified:this.extraInfo.isShowHistoryUnqualified};return new Promise((function(n,i){Object(f["m"])(D({},t)).then((function(t){var i=t.code,r=t.data;i||(e.tableData=r),n(t)})).catch((function(e){i(e)}))}))},handleGenerateBarcode:function(){var e=this,t=this.tableData.reduce((function(e,t){return e+t.number}),0);if(t!==this.barCodeNumber){var n=D({},this.extraInfo,{},this.query);return new Promise((function(t,i){Object(f["i"])(D({},n)).then((function(n){var i=n.code,r=n.data;i||(e.tableData=r.map((function(e){return D({},e,{number:e.isCanEdit?1:e.number})}))),t(n)})).catch((function(e){i(e)}))}))}this.$notify.warning({title:"警告",message:"打码数量已达最大拆出限度，不可再拆！"})},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该条码, 是否继续?","提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",cancelButtonClass:"btn-custom-cancel",type:"warning",lockScroll:!1}).then((function(){t.tableData=t.tableData.filter((function(t){return t.barCode!==e.barCode})),t.$notify.success({title:"成功",message:"该不合格品已删除"})})).catch((function(){t.$notify.info({title:"消息",message:"已取消删除"})}))},handleConfirm:function(){var e=this,t=this.tableData.reduce((function(e,t){return e+t.number}),0);if(t>this.barCodeNumber)this.$notify.warning({title:"警告",message:"打码数量(".concat(t,")超出总数量(").concat(this.barCodeNumber,")，请重新打码！")});else{var n={deliveryMaterialDetailId:this.extraInfo.deliveryMaterialDetailId,unqualifiedBarcodeList:this.tableData};Object(f["s"])(n).then((function(t){e.$emit("confirm",e.tableData),e.$emit("input",!1)})).catch((function(t){e.$emit("input",!1)}))}},beforeClose:function(e){"function"===typeof e&&e(),this.$emit("input",!1)}}},P=S,_=(n("35cf"),Object(w["a"])(P,k,I,!1,null,"4d756b84",null)),N=_.exports;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=function(){return{materialCode:"",materialName:"",deliveryNumber:"",dmiList:[]}},T={name:"InStorageInspectionDetail",components:{ScanQrCodes:O,CaptchaHumanBypass:N},mixins:[u["a"],d["a"]],props:{node:{type:Object,default:function(){return{}}}},data:function(){return{title:this.$route.meta.title,form:{inspectType:""},rules:{inspectType:[{required:!0,message:"请选择检验类型",trigger:"change"}]},baseInfo:$(),refreshKey:(new Date).getTime(),visible:!1,dmdColumnList:[{module:"word",prop:"barCode",label:"条码号",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"number",label:"数量",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"unitName",label:"计量单位",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"}],dmdLoading:!1,packageCodeList:[],currentItem:{},visible1:!1,columnList:[{module:"word",prop:"barCode",label:"条码号",align:"center",minWidth:"200",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"snNo",label:"序列号",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"number",label:"数量",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"inspectResult",label:"检验结论",align:"center",minWidth:"200",fixed:!1,sortable:!1,resizable:!0,formatter:function(e){return e.inspectResult?"合格":"不合格"},headerAlign:"center"},{module:"input",prop:"remarks",label:"不合格原因",align:"center",minWidth:"200",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center",showOverflowTooltip:!1,handleChange:function(e){var t={barCode:e.barCode,remarks:e.remarks};Object(f["e"])(t).then((function(e){})).catch((function(e){}))}}],tableData:[],isStickyBtn:!0}},computed:{isShowHistoryUnqualified:function(){var e=this;return!!this.tableData.length&&this.tableData.some((function(t){return t.deliveryMaterialDetailId===e.currentItem.deliveryMaterialDetailId}))}},watch:{"node.id":{handler:function(e){e&&(this.baseInfo=$(),this.initInfo())},immediate:!0},visible:{handler:function(e){e&&(this.isStickyBtn=!1),!e&&(this.isStickyBtn=!0)},immediate:!0},visible1:{handler:function(e){e&&(this.isStickyBtn=!1),!e&&(this.isStickyBtn=!0)},immediate:!0}},mounted:function(){},methods:{initInfo:function(){var e=this,t={deliveryMaterialId:this.node.id||""};return new Promise((function(n,i){Object(f["k"])(B({},t)).then((function(t){var i=t.code,r=t.data;if(!i){var a=r.inspectType,o=Object(c["a"])(r,["inspectType"]);e.baseInfo=o,e.form={inspectType:a},!e.baseInfo.useMinUnit&&e.getPackageCodeList(),e.tableData=r.dmiList.filter((function(e){return e.isShow}))}n(t)})).catch((function(e){i(e)}))}))},getPackageCodeList:function(){var e=this;return this.dmdLoading=!0,new Promise((function(t,n){Object(f["q"])({deliveryMaterialId:e.node.id}).then((function(n){var i=n.code,r=n.data;i||(e.packageCodeList=r.map((function(e){return B({},e,{num:e.number})}))),e.dmdLoading=!1,t(n)})).catch((function(t){e.dmdLoading=!1,n(t)}))}))},handleRowClick1:function(e){e.row,e.rowIndex;var t=e.column;e.cell,e.event;if("操作"===t.label)return!1},handleRowClick2:function(e){e.row,e.rowIndex;var t=e.column;e.cell,e.event;if("操作"===t.label)return!1},handleCaptchaHumanBypass:function(e){this.visible=!0,this.currentItem=e},handleScanQRCodes:function(){this.visible1=!0},handlePrintBarcode:function(e){this.getDataAndPrint(f["a"],B({},e))},handleDeleteBarcode:function(e,t){var n=this;this.isStickyBtn=!1,this.$confirm("此操作将永久删除选中信息, 是否继续?","提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",type:"warning",cancelButtonClass:"btn-custom-cancel",lockScroll:!1}).then((function(){Object(f["c"])({barCode:e.barCode}).then((function(t){var i=e.deliveryMaterialDetailId,r=e.number;n.packageCodeList.forEach((function(e,t){e.deliveryMaterialDetailId===i&&(e.number=e.number+r)})),n.tableData=n.tableData.filter((function(t){return t.barCode!==e.barCode})),n.$notify.success({title:"成功",message:"删除成功"})})).catch((function(e){})),n.isStickyBtn=!0})).catch((function(e){n.$notify.info({title:"消息",message:"已取消删除"}),n.isStickyBtn=!0}))},handleScanConfirm:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){e.tableData.push(t)}))},handleCaptchaHumanBypassConfirm:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this.currentItem.deliveryMaterialDetailId;if(t.length){this.tableData=this.tableData.filter((function(e){return e.deliveryMaterialDetailId!==t[0].deliveryMaterialDetailId})),t.forEach((function(t){e.tableData.push(t)}));var i=this.tableData.reduce((function(e,t){return t.deliveryMaterialDetailId===n?e+t.number:0}),0);this.packageCodeList.forEach((function(e){e.deliveryMaterialDetailId===n&&(e.number=e.num-i)}))}},getUnqualifiedBarcodeList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(t,n){Object(f["m"])(B({},e)).then((function(e){e.code,e.data;t(e)})).catch((function(e){n(e)}))}))},handleSave:function(){var e=this;this.$refs["form"].validate((function(t){t&&(e.isStickyBtn=!1,e.$confirm("是否保存检验结论?","提示",{confirmButtonText:"确 定",cancelButtonText:"取 消",type:"warning",cancelButtonClass:"btn-custom-cancel",lockScroll:!1}).then((function(){var t=e.baseInfo.dmiList.filter((function(e){return!e.isShow}));Object(f["r"])(B({deliveryMaterialId:e.node.id||"",dmiList:[].concat(Object(l["a"])(e.tableData),Object(l["a"])(t)),packageCodeSamplingList:e.packageCodeList,deliveryReceiptId:e.$route.params.id},e.form)).then((function(t){var n=t.code;n||(e.$notify.success({title:"成功",message:"保存成功"}),e.$emit("enterNextMaterial"))})).catch((function(e){})),e.isStickyBtn=!0})).catch((function(t){e.$notify.info({title:"消息",message:"已取消保存"}),e.isStickyBtn=!0})))}))}}},M=T,q=(n("a2cc"),Object(w["a"])(M,o,s,!1,null,"b2e95b8e",null)),E=q.exports,W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tabs-wrapper",style:{height:e.height}},[n("div",{staticClass:"tabs-container"},[n("div",{ref:"tabsLeft",staticClass:"tabs-left"},e._l(e.data,(function(t,i){return n("div",{key:i,staticClass:"label",class:{"is-active":i===e.currentIndex},attrs:{id:i===e.currentIndex?"isActive":"tabItem"},on:{click:function(n){return e.handleClick(t,i)}}},[n("div",{staticClass:"serialNo"},[e._v(e._s(i+1))]),n("div",{staticClass:"tag"},[n("div",{staticClass:"code"},[e._v(e._s(t.materialCode))]),n("div",{staticClass:"name"},[e._v(e._s(t.materialName))])])])})),0),n("div",{staticClass:"tabs-right",attrs:{id:"tabsRight"}},[e._t("main-container",null,{handleClick:e.handleClick})],2)])])},R=[],A=(n("7514"),{props:{height:{type:[String,Number],default:"550px"},data:{type:Array,default:function(){return[]}}},data:function(){return{currentIndex:0}},mounted:function(){var e=this,t=this.data.find((function(e){return[1].includes(e.status)}));t?this.data.forEach((function(n,i){t.id===n.id&&e.handleClick(t,i)})):this.handleClick(this.data[0],0)},methods:{handleClick:function(e,t){this.currentIndex=t,this.$emit("tabPanelClick",{item:e,index:t}),this.$nextTick((function(){var e=document.getElementById("isActive"),t=e.parentNode;t.scrollTo({top:e.offsetTop,behavior:"smooth"})}))}}}),K=A,z=(n("e2631"),Object(w["a"])(K,W,R,!1,null,"562cd3aa",null)),U=z.exports,F={data:function(){return{treeRefName:"tree",defaultPropsMixins:{children:"children",label:"name",isLeaf:function(e){return!e.hasleaf}},treeLoadingMixins:!1,treeQueryFocus:!1,treeQueryMixins:"",treeDataMixins:[],defaultCheckedNodeMixins:"",defaultExpandKeysMixins:[]}},methods:{getCurrentTreeStatus:function(){this.defaultCheckedNodeMixins=this.$refs[this.treeRefName].getCurrentKey()},handleRefreshTree:function(){var e=this;this.defaultCheckedNodeMixins=this.$refs[this.treeRefName].getCurrentKey();var t=this.nodeInfo;this.initTreeMixins().then((function(){e.setCurrentNode(t)}))},handleNodeExpand:function(e){var t=!1;this.defaultExpandKeysMixins.some((function(n){if(n===e.id)return t=!0,!0})),t||this.defaultExpandKeysMixins.push(e.id)},collapseAllNodes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].id),Array.isArray(e[n].children)&&(t=[].concat(Object(l["a"])(t),Object(l["a"])(this.collapseAllNodes(e[n].children))));return t},handleNodeCollapse:function(e){var t=this;this.defaultExpandKeysMixins.forEach((function(n,i){n===e.id&&(t.defaultExpandKeysMixins.splice(i,1),e.children&&Array.isArray(e.children)&&t.defaultExpandKeysMixins.forEach((function(n){var i=t.collapseAllNodes(e.children).includes(n);i&&(t.defaultExpandKeysMixins=t.defaultExpandKeysMixins.filter((function(e){return e!==n})))})))}))},resetCurrentNode:function(){var e=this;this.nodeInfo={},this.initTreeMixins().then((function(){e.$nextTick((function(){e.$refs[e.treeRefName].setCurrentKey()}))}))},setCurrentNode:function(e){var t=this;this.$nextTick((function(){t.$refs[t.treeRefName].setCurrentKey(),t.$nextTick((function(){t.$refs[t.treeRefName].setCurrentKey(e.id);var n=t.$refs[t.treeRefName].getNode(e.id);t.handleNodeClick(n.data,n)}))}))}}};function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G={name:"InStorageInspectionStart",components:{Right:E,Tabs:U},filters:{ellipsis:function(e,t){return e&&e.length>t?e.slice(0,t)+"...":e}},mixins:[F],data:function(){return{query:{nameOrCode:""},nodeInfo:{},nodeIndex:0,rightKey:1,baseInfo:{},activeName:"first",tabsList:[]}},created:function(){var e=this;this.getInspectNoDetail().then((function(t){e.init()}))},methods:{init:function(){var e=this;return new Promise((function(t,n){Object(f["g"])({deliveryReceiptId:e.$route.params.id}).then((function(n){var i=n.code,r=n.data;i||(e.tabsList=r),t(n)})).catch((function(e){n(e)}))}))},handleClick:function(e,t){},enterNextMaterial:function(e){if(this.tabsList.length){if(1===this.tabsList.length)return;this.tabsList.length>1&&(this.nodeIndex++,this.nodeIndex>this.tabsList.length-1&&(this.nodeIndex=0),e(this.tabsList[this.nodeIndex],this.nodeIndex))}},handleSearch:function(){var e=this;this.$nextTick((function(){e.query.nameOrCode&&e.tabsList.forEach((function(t,n){t.materialCode!==e.query.nameOrCode&&t.materialName!==e.query.nameOrCode||e.$refs.Tabs.handleClick(t,n)}))}))},handleGoBack:function(){this.$store.dispatch("tagsView/delView",this.$route),this.$router.push({name:"InStorageInspectionDetail",params:{id:this.$route.params.id}})},getInspectNoDetail:function(){var e=this;return new Promise((function(t,n){Object(f["j"])({id:e.$route.params.id}).then((function(n){var i=n.code,r=n.data;i||(e.baseInfo=r),t(n)})).catch((function(e){n(e)}))}))},handleTabClick:function(e){var t=e.item,n=e.index;this.rightKey++,this.nodeInfo=Q({},t),this.nodeIndex=n}}},V=G,J=(n("4c2c"),Object(w["a"])(V,i,r,!1,null,"372722c0",null));t["default"]=J.exports},b26b:function(e,t,n){},ce7e:function(e,t,n){var i=n("63b6"),r=n("584a"),a=n("294c");e.exports=function(e,t){var n=(r.Object||{})[e]||Object[e],o={};o[e]=t(n),i(i.S+i.F*a((function(){n(1)})),"Object",o)}},cea1:function(e,t,n){},d9a5:function(e,t,n){},e2631:function(e,t,n){"use strict";var i=n("d9a5"),r=n.n(i);r.a},e265:function(e,t,n){e.exports=n("ed33")},e5e8:function(e,t,n){},ed33:function(e,t,n){n("014b"),e.exports=n("584a").Object.getOwnPropertySymbols}}]);
//# sourceMappingURL=InStorageInspectionStart.8d40230b.js.map