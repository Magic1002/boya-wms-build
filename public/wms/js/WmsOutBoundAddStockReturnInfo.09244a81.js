(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["WmsOutBoundAddStockReturnInfo"],{"0783":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-row",{staticClass:"clearfix"},[r("div",{staticClass:"fr"},[r("el-button",{attrs:{type:"primary",disabled:!e.tableSelection.length},on:{click:function(t){return e.handleNextStep("form")}}},[e._v("下一步")])],1)]),r("el-form",{ref:"form",attrs:{inline:"",model:e.form,rules:e.rules,"label-width":"80px","label-position":"left"}},[r("el-row",[r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"退库单号",prop:"billNumber"}},[r("el-input",{staticStyle:{width:"178px"},attrs:{disabled:"",placeholder:"请填写退库单号"},model:{value:e.form.billNumber,callback:function(t){e.$set(e.form,"billNumber",t)},expression:"form.billNumber"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"退库日期",prop:"date"}},[r("el-input",{staticStyle:{width:"178px"},attrs:{disabled:"",placeholder:"请填写退库日期"},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"出库单号",prop:"stockOutNumber"}},[r("el-input",{staticStyle:{width:"143px"},attrs:{disabled:"",placeholder:"请选择出库单"},model:{value:e.form.stockOutNumber,callback:function(t){e.$set(e.form,"stockOutNumber",t)},expression:"form.stockOutNumber"}}),r("el-button",{staticStyle:{"margin-left":"5px","padding-left":"0","padding-right":"0",width:"30px"},attrs:{type:"success",icon:"el-icon-plus"},on:{click:function(t){e.stockReturnVisible=!0}}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"是否检验",prop:"inspect"}},[r("el-radio-group",{staticStyle:{width:"178px"},on:{input:e.inspectChange},model:{value:e.form.inspect,callback:function(t){e.$set(e.form,"inspect",t)},expression:"form.inspect"}},[r("el-radio-button",{attrs:{label:!0}},[e._v("是")]),r("el-radio-button",{attrs:{label:!1}},[e._v("否")])],1)],1)],1)],1)],1),r("el-row",[r("el-form",{ref:"queryForm",staticClass:"clearfix top-filter",attrs:{model:e.query,inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{staticClass:"fl",attrs:{prop:"materialCodeOrName"}},[r("el-input",{staticClass:"filter-item",staticStyle:{width:"178px"},attrs:{placeholder:"物料编号或名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchInit(t)}},model:{value:e.query.materialCodeOrName,callback:function(t){e.$set(e.query,"materialCodeOrName",t)},expression:"query.materialCodeOrName"}})],1),r("el-button",{staticClass:"filter-item",attrs:{type:"success",icon:"el-icon-search"},on:{click:e.init}},[e._v("搜索")]),r("el-button",{staticClass:"filter-item",attrs:{type:"warning",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("queryForm")}}},[e._v("重置")]),e.isCheckAll?e._e():r("el-button",{staticClass:"filter-item",attrs:{type:"warning",plain:""},on:{click:e.checkAll}},[e._v("跨页全选")]),e.isCheckAll?r("el-button",{staticClass:"filter-item",attrs:{type:"warning",plain:""},on:{click:e.reverseSelection}},[e._v("跨页反选")]):e._e()],1)],1),r("el-row",[r("table-com",{ref:e.refName,attrs:{"table-height-type":560,loading:e.loading,index:!0,"index-fixed":!1,selection:!0,"row-key":e.rowKey,multiple:!0,"selection-fixed":!1,"table-column-sort":!1,"table-data":e.tableData,"column-list":e.columnList,"show-operate":!1,"operate-fixed":!1,"operation-width":120,"table-selection":e.tableSelection,selectable:e.selectable},on:{selectionChange:e.selectionChange,refresh:e.searchInit}})],1),r("pagination",{attrs:{page:e.pageInfo.current,limit:e.pageInfo.size,total:e.total},on:{"update:page":function(t){return e.$set(e.pageInfo,"current",t)},"update:limit":function(t){return e.$set(e.pageInfo,"size",t)},pagination:e.init}}),r("return-warehouse-order-dialog",{attrs:{selection:[],multiple:!1,"extra-info":{forBusiness:"returnWarehouse",excludeStockOutNumbers:e.form.stockOutNumber?[e.form.stockOutNumber]:[]}},on:{confirm:e.onSelectConfirm},model:{value:e.stockReturnVisible,callback:function(t){e.stockReturnVisible=t},expression:"stockReturnVisible"}})],1)},i=[],o=(r("8e6e"),r("456d"),r("75fc")),a=r("768b"),l=(r("6762"),r("2fdb"),r("ac6a"),r("a8db")),u=r("bd86"),s=r("7e6e"),c=r("1790"),f=r("333d"),d=r("5ddb"),m=r("cf43");function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){Object(u["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h={name:"OutBoundStockReturn",components:{Pagination:f["a"],ReturnWarehouseOrderDialog:s["a"]},mixins:[c["a"]],data:function(){return{title:this.$route.meta.title,query:{materialCodeOrName:""},loading:!1,tableData:[],columnList:[{module:"word",prop:"materialGroupCode",label:"物料组",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,headerAlign:"center",formatter:null},{module:"word",prop:"materialCode",label:"物料编号",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,headerAlign:"center",formatter:null},{module:"word",prop:"materialName",label:"物料名称",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"materialAssessType_dictText",label:"评估类型",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"realNum",label:"出库数量",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"},{module:"word",prop:"returnNum",label:"已退库数量",align:"center",minWidth:"",fixed:!1,sortable:!1,resizable:!0,formatter:null,headerAlign:"center"}],form:{billNumber:"",date:"",stockOutNumber:"",inspect:null},rules:{stockOutNumber:[{required:!0,message:"请选择出库单号",trigger:"blur"}],date:[{required:!0,message:"请填写退库日期",trigger:"blur"}],billNumber:[{required:!0,message:"请填写退库单号",trigger:"blur"}],inspect:[{required:!0,message:"请选择是否检验",trigger:"change"}]},stockReturnVisible:!1,tableSelection:[],tkInfo:{},rowKey:"id",refName:"baseTableRef",isCheckAll:!1}},computed:{},mounted:function(){this.generateStockReturnOrder()},methods:{generateStockReturnOrder:function(){var e=this;return new Promise((function(t,r){Object(m["d"])().then((function(r){var n=r.code,i=r.data;n||(e.tkInfo=p({},i),e.form.billNumber=e.tkInfo.billNumber,e.form.date=e.tkInfo.date,e.form.inspect=e.tkInfo.inspect),t(r)})).catch((function(e){r(e)}))}))},init:function(){var e=this;return this.loading=!0,new Promise((function(t,r){var n=p({page:p({},e.pageInfo)},e.query,{stockOutNumber:e.form.stockOutNumber,forBusiness:"returnWarehouse"});Object(d["b"])(p({},n)).then((function(r){var n=r.code,i=r.data;if(!n){var o=i.list,a=Object(l["a"])(i,["list"]);e.initPage(a),e.tableData=o;try{var u=e.rowKey,s=e.tableSelection.map((function(e){return e[u]}));e.tableData.forEach((function(t){function r(e){var t=e[u];return s.some((function(e){return e===t}))}r(t)&&e.$nextTick((function(){e.$refs[e.refName].$refs.multipleTable.toggleRowSelection(t,!0)}))}))}catch(c){}}e.loading=!1,t(r)})).catch((function(t){e.loading=!1,r(t)}))}))},handleGoBack:function(){this.$store.dispatch("tagsView/delView",this.$route),this.$router.push({name:"OutBoundStockReturn"})},handleNextStep:function(e){var t=this;this.$refs[e].validate((function(e){e&&Object(m["a"])({billNumber:t.form.billNumber,stockOutNumber:t.form.stockOutNumber,detailList:t.tableSelection.map((function(e){return{stockOutDetailId:e.id}})),allSelectedFlag:t.isCheckAll}).then((function(e){t.$store.dispatch("tagsView/delView",t.$route),t.$router.push({name:"WmsOutBoundStockReturnOrderInfo",params:{billNumber:t.tkInfo.billNumber}})})).catch((function(e){}))}))},resetForm:function(e){this.$refs[e].resetFields(),this.searchInit()},checkAll:function(){var e=this;this.isCheckAll=!0;var t=p({},this.query,{stockOutNumber:this.form.stockOutNumber,forBusiness:"returnWarehouse",page:{current:1,size:1e4}});return new Promise((function(r,n){Object(d["b"])(p({},t)).then((function(t){var n=t.code,i=t.data;if(!n){var o=i.list;if(o&&Array.isArray(o)&&o.length){if(e.tableSelection=o.filter((function(e){return e.realNum-e.returnNum>0})),!e.tableSelection.length)return e.isCheckAll=!1,void e.$notify.warning({title:"警告",message:"暂不支持跨页全选"});var a=e.rowKey,l=e.tableSelection.map((function(e){return e[a]})),u=[];e.tableData.forEach((function(t){function r(e){var t=e[a];return l.some((function(e){return e===t}))}r(t)&&(u.push(t),e.$nextTick((function(){e.$refs[e.refName].$refs.multipleTable.toggleRowSelection(t,!0)})))})),e.tableSelection.forEach((function(t){var r=u.map((function(e){return e[a]}));r.includes(t[a])||e.$nextTick((function(){e.$refs[e.refName].$refs.multipleTable.toggleRowSelection(t,!0)}))}))}}r(t)})).catch((function(e){n(e)}))}))},reverseSelection:function(){var e=this;this.isCheckAll=!1,this.$nextTick((function(){e.$refs[e.refName].$refs.multipleTable.clearSelection(),e.tableSelection=[]}))},onSelectConfirm:function(e){var t=Object(a["a"])(e,1),r=t[0],n=r.stockOutNumber;this.form.stockOutNumber=n,this.init()},selectionChange:function(e){this.tableSelection=Object(o["a"])(e)},inspectChange:function(){var e=this;return new Promise((function(t,r){Object(m["h"])({id:e.tkInfo.id,inspect:e.form.inspect}).then((function(e){t(e)})).catch((function(e){r(e)}))}))},selectable:function(e,t){return e.realNum-e.returnNum>0}}},g=h,k=r("2877"),O=Object(k["a"])(g,n,i,!1,null,"9b177e1e",null);t["default"]=O.exports},"5ddb":function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return c})),r.d(t,"i",(function(){return f})),r.d(t,"j",(function(){return d})),r.d(t,"a",(function(){return m})),r.d(t,"m",(function(){return b})),r.d(t,"k",(function(){return p})),r.d(t,"l",(function(){return h}));var n=r("bc43");function i(e){return Object(n["a"])({url:"/outWarehouse/wmsOutWarehouseInfo/pageList",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/outWarehouse/wmsStockOutDetail/pageList",method:"post",data:e})}function a(e){return Object(n["a"])({url:"/outWarehouse/wmsBillMaterialRequisitionDetail/pageList",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/outWarehouse/wmsBillMaterialRequisition/detail",method:"post",data:e})}function u(e){return Object(n["a"])({url:"/outWarehouse/wmsBillReservedMaterialDetail/pageList",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/outWarehouse/wmsBillReservedSub/detail",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/outWarehouse/wmsBillReturnMaterialsDetail/pageList",method:"post",data:e})}function f(e){return Object(n["a"])({url:"/outWarehouse/wmsBillReturnMaterials/detail",method:"post",data:e})}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/warehouseMgt/wmsInventoryBookDetail/restoreSplitBarcode2",method:"post",data:e})}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/warehouseMgt/wmsInventoryBookDetail/barcodePrintBatch",method:"post",data:e})}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/warehouseMgt/wmsInventoryBookDetail/splitMultiBarcode",method:"post",data:e})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/warehouseMgt/wmsInventoryBookDetail/saveSplitBarcodeList",method:"post",data:e})}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"/warehouseMgt/wmsInventoryBookDetail/split4StockOut",method:"post",data:e})}}}]);
//# sourceMappingURL=WmsOutBoundAddStockReturnInfo.09244a81.js.map